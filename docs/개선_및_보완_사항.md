    # BubbleMap 개선 및 보완 사항

프로젝트 검토 결과, 수정/보완이 필요한 항목을 정리한 문서입니다.  
우선순위: **높음** → **중간** → **낮음** 순으로 진행하는 것을 권장합니다.

---

## 1. 추가했으면 좋은 것

### 1.1 문서와 실제 구현 정합성 (중간)

| 현황 | 조치 |
|------|------|
| README·`public/img/README.txt`는 "3D globe", "Three.js", "earth texture"를 전제로 함 | 현재 구현은 **Leaflet 2D 지도**이므로, (A) README를 "2D Leaflet 지도" 기준으로 수정하거나, (B) "현재 2D, 추후 3D 예정" 등으로 명시 |

- **관련 파일**: `README.md`, `public/img/README.txt`

---

### 1.2 로딩/에러 UX (높음)

| 항목 | 내용 |
|------|------|
| **로딩 표시** | 뉴스 API 호출 중 스피너 또는 스켈레톤 UI 추가. 네트워크가 느릴 때 빈 화면으로 보이지 않도록 함 |
| **에러 처리** | `fetchNews` 실패 시 사용자에게 "뉴스를 불러오지 못했습니다" 메시지 표시 |
| **재시도** | 에러 시 "재시도" 버튼 제공 |

- **관련 파일**: `public/js/main.js` (`loadAndShowNews` catch 블록), `public/index.html` (로딩/에러 UI 마크업)

#### 초보 개발자를 위한 설명: "로딩/에러 UX"가 뭔가요?

**UX** = 사용자 경험(User Experience). 화면에서 사용자가 **무슨 일이 일어나고 있는지**, **실패했을 때 무엇을 해야 하는지** 알 수 있게 만드는 것을 말합니다.

**지금 문제 (추가 전):**

1. **로딩 중**: 페이지를 열면 뉴스를 서버에서 가져오는 동안 **아무 반응이 없음**. 사용자는 "멈춘 건가? 버그인가?" 하고 헷갈릴 수 있음.
2. **에러 시**: API가 실패해도 **화면에는 그대로**이고, 개발자 도구 콘솔에만 `Failed to load news: ...` 로그가 찍힘. 일반 사용자는 에러를 모름.
3. **재시도**: 실패했을 때 다시 시도할 수 있는 **버튼이 없음**. 새로고침만 해야 함.

**추가하면 좋은 것 (쉽게 말하면):**

| 문서 용어 | 쉬운 말 | 화면에 보이는 것 |
|-----------|---------|------------------|
| **로딩 표시** | "지금 불러오는 중이에요" 알림 | 🔄 도는 스피너, 또는 회색 네모 칸(스켈레톤)이 잠깐 보임 → 뉴스가 오면 사라지고 지도/버블 표시 |
| **에러 처리** | "불러오기 실패했어요" 메시지 | 지도 위나 패널에 **"뉴스를 불러오지 못했습니다"** 같은 문구 표시 (콘솔만이 아니라 사용자가 보는 곳에) |
| **재시도** | "다시 시도할 수 있는 버튼" | 에러 메시지 옆에 ** [재시도] ** 버튼 → 누르면 `loadAndShowNews()` 다시 호출 |

**구현 흐름 (참고):**

1. **HTML** (`public/index.html`): 로딩용 div(스피너 넣을 곳), 에러용 div(메시지 + 재시도 버튼) 추가. 처음에는 `hidden` 또는 `display:none`으로 숨김.
2. **JS** (`main.js`):  
   - `loadAndShowNews` **시작할 때** → 로딩 div 보이게, 에러 div 숨김.  
   - **성공하면** → 로딩 숨김, 지도/버블 표시.  
   - **catch에서 실패하면** → 로딩 숨김, 에러 div 보이게 하고 "뉴스를 불러오지 못했습니다" + 재시도 버튼에 `loadAndShowNews` 연결.

이렇게 하면 "로딩 중 → 성공/실패 → 실패 시 재시도"까지 사용자가 한눈에 이해할 수 있어서 **로딩/에러 UX**가 좋아집니다.

---

### 1.3 타임라인 의미 명확화 (낮음)

| 현황 | 조치 |
|------|------|
| 타임라인 레이블이 `0:00, 3:00, 6:00…`인데, 실제 동작은 **지난 7일** 구간의 비율(0% = 7일 전, 100% = 지금) | 라벨을 "7 days ago" ~ "Now" 또는 "Older" ~ "Newest" 등으로 변경하거나, 툴팁으로 설명 추가 |

- **관련 파일**: `public/index.html` (타임라인 마크업), `public/css/style.css`, `public/js/main.js`

---

### 1.4 헤더 버튼 역할 정리 (낮음)

| 현황 | 조치 |
|------|------|
| 메뉴(☰), Documents(▤), Sources(⎔), Globe(◉), Mute(🔇), Settings(⚙), Profile(👤) 등이 **동작하지 않음** | (A) 실제 기능 구현 또는 (B) 당분간 사용하지 않을 버튼은 비활성화/제거 후 "Coming soon" 등 툴팁 표기 |

- **관련 파일**: `public/index.html`, `public/js/main.js` (필요 시 이벤트 바인딩)

---

### 1.5 접근성·반응형 (낮음)

| 항목 | 내용 |
|------|------|
| **키보드** | 버블/버튼 포커스, Enter로 선택 등 키보드만으로 조작 가능하게 하면 접근성 향상 |
| **모바일** | 우측 패널 360px 고정 → 작은 화면에서 미디어 쿼리 또는 접이식 패널 등 레이아웃 개선 검토 |

- **관련 파일**: `public/index.html`, `public/css/style.css`, `public/js/main.js`

---

### 1.6 테스트 (중간)

| 항목 | 내용 |
|------|------|
| **단위 테스트** | `articlesToRegions`, `filterArticlesByTimeline`, `escapeHtml` 등 순수 함수부터 테스트 추가 |
| **통합 테스트** | API 실패 시 mock으로 UI만 검증하는 간단한 테스트 추가 (선택) |

- **관련 파일**: 테스트 프레임워크 도입 후 `public/js/main.js` 등 대상 모듈에 대응하는 테스트 파일

---

### 1.7 서버 측 보강 (중간)

| 항목 | 내용 |
|------|------|
| **환경 검증** | 서버 시작 시 `NEWS_API_KEY` 유무를 로그로 출력 (예: "Running with mock news (no API key)") |
| **Rate limit** | `/api/news`에 `express-rate-limit` 등으로 요청 제한 두어 남용 방지 |

- **관련 파일**: `server.js`, `package.json` (rate limit 패키지 추가 시)

---

## 2. 기존 코드에서 수정했으면 좋은 것

### 2.1 보안: .env.example에 API 키 제거 (높음)

| 현황 | 조치 |
|------|------|
| `.env.example`에 실제 API 키가 들어가 있으면, 저장소에 올렸을 때 키가 유출됨 | **실제 키는 제거**하고 `NEWS_API_KEY=your_api_key_here` 같은 **placeholder만** 사용. 실제 키는 `.env`에만 두고 `.env`는 `.gitignore`로 커밋 제외 |

- **관련 파일**: `.env.example`
- **참고**: `.env.example`은 저장소에 올라가는 템플릿이므로, 실제 키가 있으면 유출됩니다. 진짜 키는 `.env`에만 두고 Git에 커밋하지 않습니다.

---

### 2.2 국가 코드·좌표 중복 (중간)

| 현황 | 조치 |
|------|------|
| `server.js`에 `COUNTRY_COORDS`, `main.js`에 `COUNTRY_NAMES`가 각각 있어 국가 추가/수정 시 두 곳을 맞춰야 함 | 국가 메타데이터(코드, 좌표, 표시 이름)를 **한 곳**(공용 `constants.js` 또는 서버의 작은 JSON)에서 관리하고, 서버/클라이언트가 공통 데이터 참조하도록 정리 |

- **관련 파일**: `server.js`, `public/js/main.js`, (신규) 공용 데이터 파일

---

### 2.3 newsService.js – 에러·타임아웃 (중간)

| 현황 | 조치 |
|------|------|
| `fetch` 실패 시 네트워크 에러/타임아웃에 대한 사용자 친화적 메시지 없음 | `AbortController` + `setTimeout`으로 **타임아웃**(예: 10초) 추가. catch에서 "네트워크 오류" 등 **메시지 정리** 후 throw. 상위에서 재시도 버튼과 연결 |

- **관련 파일**: `public/js/newsService.js`, `public/js/main.js`

---

### 2.4 main.js – 전역 객체 (낮음)

| 현황 | 조치 |
|------|------|
| `window.bubbleMap`에 `getBubbleRefs`, `getMap`, `loadNews` 등이 전부 노출됨 | 디버깅용이라면 **필요한 것만** 노출하거나, 배포 시 제거/최소화 |

- **관련 파일**: `public/js/main.js`

---

### 2.5 HTML – 문서와 불일치 (중간)

| 현황 | 조치 |
|------|------|
| README는 "Three.js, import map for Three.js"라고 하는데 실제는 **Leaflet** 사용 | **README를 Leaflet 기준**으로 수정하여 문서와 구현 일치시키기 (1.1과 동일 이슈) |

- **관련 파일**: `README.md`, `public/index.html` (필요 시)

---

### 2.6 XSS 방지 – escapeHtml (낮음)

| 현황 | 조치 |
|------|------|
| `escapeHtml`에서 `'`(작은따옴표) 이스케이프 없음 | `'` → `&#39;` 등으로 **이스케이프 추가**하여 속성 내 따옴표에서도 XSS 위험 제거 |

- **관련 파일**: `public/js/main.js` (`escapeHtml`)

---

### 2.7 mapRenderer.js – resize 리스너 (낮음)

| 현황 | 조치 |
|------|------|
| `window.addEventListener('resize', onResize)`만 등록, 해제 없음 | 지도를 동적으로 제거하는 구조가 생기면 `removeEventListener`로 **리스너 해제** 추가 |

- **관련 파일**: `public/js/mapRenderer.js`

---

### 2.8 서버 – politics 카테고리 (낮음)

| 현황 | 조치 |
|------|------|
| `server.js`의 `CATEGORY_IMPORTANCE`에 `politics` 없음. `bubbleComponent.js`의 `CATEGORY_COLORS`에는 있음. mock 데이터는 `politics` 사용 | 서버의 `CATEGORY_IMPORTANCE`에 **politics** 항목 추가하여 색/중요도가 일관되게 적용되도록 함 |

- **관련 파일**: `server.js`

---

## 3. 우선순위 요약표

| 우선순위 | 항목 |
|----------|------|
| **높음** | .env.example API 키 제거 (2.1), 로딩/에러 UX (1.2) |
| **중간** | 문서·구현 정합성 (1.1, 2.5), 국가 메타데이터 통합 (2.2), newsService 타임아웃/에러 (2.3), 테스트 (1.6), 서버 보강 (1.7) |
| **낮음** | 타임라인 라벨 (1.3), 헤더 버튼 (1.4), 접근성·반응형 (1.5), 전역 객체 (2.4), escapeHtml (2.6), resize 리스너 (2.7), politics 카테고리 (2.8) |

---

## 4. 진행 시 참고

- 한 번에 전부 하지 않아도 됩니다. **높음 → 중간 → 낮음** 순으로 단계별 진행을 권장합니다.
- 항목 처리 후 이 문서에서 해당 섹션에 **완료 일자**나 **완료** 표시를 추가해 두면 진행 상황 파악에 도움이 됩니다.
